<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack相关的性能优化 | lei哥的技术博客</title>
    <meta name="description" content="生活中，百分之八十的问题可以运用百分之二十的知识来解决，而剩下的百分之二十的问题需要运用百分之八十的知识来解决。准备好那百分之八十的知识，才会在遇到有挑战的问题时更加游刃有余，机会永远留给准备好的人。">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/blog/assets/css/0.styles.afd5c948.css" as="style"><link rel="preload" href="/blog/assets/js/app.99d67ef5.js" as="script"><link rel="preload" href="/blog/assets/js/2.3ca9670a.js" as="script"><link rel="preload" href="/blog/assets/js/50.c5dfcbcf.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.0280af1a.js"><link rel="prefetch" href="/blog/assets/js/11.e3731d23.js"><link rel="prefetch" href="/blog/assets/js/12.6c26d675.js"><link rel="prefetch" href="/blog/assets/js/13.7574b18a.js"><link rel="prefetch" href="/blog/assets/js/14.87ecda20.js"><link rel="prefetch" href="/blog/assets/js/15.4ac18fba.js"><link rel="prefetch" href="/blog/assets/js/16.6d201469.js"><link rel="prefetch" href="/blog/assets/js/17.46113918.js"><link rel="prefetch" href="/blog/assets/js/18.7fc0700c.js"><link rel="prefetch" href="/blog/assets/js/19.228e958b.js"><link rel="prefetch" href="/blog/assets/js/20.46eab140.js"><link rel="prefetch" href="/blog/assets/js/21.a4ed8a11.js"><link rel="prefetch" href="/blog/assets/js/22.955c54e3.js"><link rel="prefetch" href="/blog/assets/js/23.9e1c44a1.js"><link rel="prefetch" href="/blog/assets/js/24.7e4f3236.js"><link rel="prefetch" href="/blog/assets/js/25.812290ae.js"><link rel="prefetch" href="/blog/assets/js/26.f9aea46e.js"><link rel="prefetch" href="/blog/assets/js/27.9bbc98aa.js"><link rel="prefetch" href="/blog/assets/js/28.4c9f8c11.js"><link rel="prefetch" href="/blog/assets/js/29.90f3ebfb.js"><link rel="prefetch" href="/blog/assets/js/3.7980a997.js"><link rel="prefetch" href="/blog/assets/js/30.1fc2319a.js"><link rel="prefetch" href="/blog/assets/js/31.7ae3932d.js"><link rel="prefetch" href="/blog/assets/js/32.4fbc98ca.js"><link rel="prefetch" href="/blog/assets/js/33.6dd1a8f0.js"><link rel="prefetch" href="/blog/assets/js/34.d6cc7b7e.js"><link rel="prefetch" href="/blog/assets/js/35.5787f137.js"><link rel="prefetch" href="/blog/assets/js/36.db0d0391.js"><link rel="prefetch" href="/blog/assets/js/37.8778f8bc.js"><link rel="prefetch" href="/blog/assets/js/38.e641582c.js"><link rel="prefetch" href="/blog/assets/js/39.c6559f93.js"><link rel="prefetch" href="/blog/assets/js/4.2ef62482.js"><link rel="prefetch" href="/blog/assets/js/40.2c031059.js"><link rel="prefetch" href="/blog/assets/js/41.cdd6e337.js"><link rel="prefetch" href="/blog/assets/js/42.234c8474.js"><link rel="prefetch" href="/blog/assets/js/43.ba01a465.js"><link rel="prefetch" href="/blog/assets/js/44.acb7356d.js"><link rel="prefetch" href="/blog/assets/js/45.a39b40ec.js"><link rel="prefetch" href="/blog/assets/js/46.ae94631d.js"><link rel="prefetch" href="/blog/assets/js/47.1cfa92e9.js"><link rel="prefetch" href="/blog/assets/js/48.6d57adc0.js"><link rel="prefetch" href="/blog/assets/js/49.9a375746.js"><link rel="prefetch" href="/blog/assets/js/5.61c1b4b6.js"><link rel="prefetch" href="/blog/assets/js/51.3ee2431d.js"><link rel="prefetch" href="/blog/assets/js/6.60d89028.js"><link rel="prefetch" href="/blog/assets/js/7.675f5461.js"><link rel="prefetch" href="/blog/assets/js/8.95aac3da.js"><link rel="prefetch" href="/blog/assets/js/9.60792a40.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.afd5c948.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">lei哥的技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/md.html" class="nav-link">
  markdown语法
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/config.html" class="nav-link">
  editorconfig
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术积累" class="dropdown-title"><span class="title">技术积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skulpt/1.html" class="nav-link">
  深入skulpt
</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">
  深入scratch
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/img.html" class="nav-link">
  图片相关总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/js-bug.html" class="nav-link">
  遇到的坑
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/base-css.html" class="nav-link">
  css3
</a></li><li class="dropdown-item"><!----> <a href="/blog/other/git.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/blog/technologyAccoumulation/request.html" class="nav-link">
  请求相关
</a></li><li class="dropdown-item"><!----> <a href="/blog/technologyAccoumulation/http.html" class="nav-link">
  http相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS开发总结" class="dropdown-title"><span class="title">JS开发总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/js-base.html" class="nav-link">
  js基础总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/inherit.html" class="nav-link">
  js继承
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/inherit2.html" class="nav-link">
  js继承(二)
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/obj.html" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/yinyong.html" class="nav-link">
  引用对象
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/js-tip.html" class="nav-link">
  js各种知识点
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/yibu.html" class="nav-link">
  异步汇总
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/core.html" class="nav-link">
  跨域相关
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/es6.html" class="nav-link">
  ES6知识
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/tool-fun.html" class="nav-link">
  工具函数总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/write-code.html" class="nav-link">
  手写代码
</a></li><li class="dropdown-item"><!----> <a href="/blog/interview/dachang.html" class="nav-link">
  面试题总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="移动端" class="dropdown-title"><span class="title">移动端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/mobile/wechat.html" class="nav-link">
  公众号开发总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/mobile/optimize.html" class="nav-link">
  移动端性能优化(一)
</a></li><li class="dropdown-item"><!----> <a href="/blog/mobile/optimize2.html" class="nav-link">
  移动端性能优化(二)
</a></li><li class="dropdown-item"><!----> <a href="/blog/mobile/mobile-bug.html" class="nav-link">
  移动端的那些坑
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/knowledgePoint.html" class="nav-link">
  Vue小知识
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/component.html" class="nav-link">
  组件化总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/uni-app.html" class="nav-link">
  Uniapp学习
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-base.html" class="nav-link">
  webpack入门
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/perform-opt.html" class="nav-link router-link-exact-active router-link-active">
  webpack优化
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-note.html" class="nav-link">
  webpack随手记
</a></li><li class="dropdown-item"><!----> <a href="/blog/other/frame/element-ui.html" class="nav-link">
  element-ui学习
</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">
  常用网址
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">
  环境配置
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/md.html" class="nav-link">
  markdown语法
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/config.html" class="nav-link">
  editorconfig
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术积累" class="dropdown-title"><span class="title">技术积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skulpt/1.html" class="nav-link">
  深入skulpt
</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">
  深入scratch
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/img.html" class="nav-link">
  图片相关总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/js-bug.html" class="nav-link">
  遇到的坑
</a></li><li class="dropdown-item"><!----> <a href="/blog/css/base-css.html" class="nav-link">
  css3
</a></li><li class="dropdown-item"><!----> <a href="/blog/other/git.html" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/blog/technologyAccoumulation/request.html" class="nav-link">
  请求相关
</a></li><li class="dropdown-item"><!----> <a href="/blog/technologyAccoumulation/http.html" class="nav-link">
  http相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS开发总结" class="dropdown-title"><span class="title">JS开发总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/javascript/js-base.html" class="nav-link">
  js基础总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/inherit.html" class="nav-link">
  js继承
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/inherit2.html" class="nav-link">
  js继承(二)
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/obj.html" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/yinyong.html" class="nav-link">
  引用对象
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/js-tip.html" class="nav-link">
  js各种知识点
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/yibu.html" class="nav-link">
  异步汇总
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/core.html" class="nav-link">
  跨域相关
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/es6.html" class="nav-link">
  ES6知识
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/tool-fun.html" class="nav-link">
  工具函数总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/javascript/write-code.html" class="nav-link">
  手写代码
</a></li><li class="dropdown-item"><!----> <a href="/blog/interview/dachang.html" class="nav-link">
  面试题总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="移动端" class="dropdown-title"><span class="title">移动端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/mobile/wechat.html" class="nav-link">
  公众号开发总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/mobile/optimize.html" class="nav-link">
  移动端性能优化(一)
</a></li><li class="dropdown-item"><!----> <a href="/blog/mobile/optimize2.html" class="nav-link">
  移动端性能优化(二)
</a></li><li class="dropdown-item"><!----> <a href="/blog/mobile/mobile-bug.html" class="nav-link">
  移动端的那些坑
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/vue/knowledgePoint.html" class="nav-link">
  Vue小知识
</a></li><li class="dropdown-item"><!----> <a href="/blog/vue/component.html" class="nav-link">
  组件化总结
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/uni-app.html" class="nav-link">
  Uniapp学习
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-base.html" class="nav-link">
  webpack入门
</a></li><li class="dropdown-item"><!----> <a href="/blog/webpack/perform-opt.html" class="nav-link router-link-exact-active router-link-active">
  webpack优化
</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-note.html" class="nav-link">
  webpack随手记
</a></li><li class="dropdown-item"><!----> <a href="/blog/other/frame/element-ui.html" class="nav-link">
  element-ui学习
</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">
  常用网址
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack相关的性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/webpack/perform-opt.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/webpack/perform-opt.html#一、优化构建速度" class="sidebar-link">一、优化构建速度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_1-1-缩小文件搜索范围" class="sidebar-link">1.1 缩小文件搜索范围</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_1-2-使用dllplugin减少基础模块编译次数" class="sidebar-link">1.2 使用DllPlugin减少基础模块编译次数</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_1-3-使用happypack开启多进程loader转换" class="sidebar-link">1.3 使用HappyPack开启多进程Loader转换</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_1-4-使用paralleluglifyplugin开启多进程压缩js文件" class="sidebar-link">1.4 使用ParallelUglifyPlugin开启多进程压缩JS文件</a></li></ul></li><li><a href="/blog/webpack/perform-opt.html#二、优化开发体验" class="sidebar-link">二、优化开发体验</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_2-1-使用自动刷新" class="sidebar-link">2.1 使用自动刷新</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_2-2-开启模块热替换hmr" class="sidebar-link">2.2 开启模块热替换HMR</a></li></ul></li><li><a href="/blog/webpack/perform-opt.html#三、优化输出质量-压缩文件体积" class="sidebar-link">三、优化输出质量-压缩文件体积</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_3-1-区分环境-减小生产环境代码体积" class="sidebar-link">3.1 区分环境--减小生产环境代码体积</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_3-2-压缩代码-js、es、css" class="sidebar-link">3.2 压缩代码-JS、ES、CSS</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_3-3-使用tree-shaking剔除js死代码" class="sidebar-link">3.3 使用Tree Shaking剔除JS死代码</a></li></ul></li><li><a href="/blog/webpack/perform-opt.html#四、优化输出质量-加速网络请求" class="sidebar-link">四、优化输出质量--加速网络请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_4-1-使用cdn加速静态资源加载" class="sidebar-link">4.1 使用CDN加速静态资源加载</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_4-2-多页面应用提取页面间公共代码，以利用缓存" class="sidebar-link">4.2 多页面应用提取页面间公共代码，以利用缓存</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_4-3-分割代码以按需加载" class="sidebar-link">4.3 分割代码以按需加载</a></li></ul></li><li><a href="/blog/webpack/perform-opt.html#五、优化输出质量-提升代码运行时的效率" class="sidebar-link">五、优化输出质量--提升代码运行时的效率</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_5-1-使用prepack提前求值" class="sidebar-link">5.1 使用Prepack提前求值</a></li><li class="sidebar-sub-header"><a href="/blog/webpack/perform-opt.html#_5-2-使用scope-hoisting" class="sidebar-link">5.2 使用Scope Hoisting</a></li></ul></li><li><a href="/blog/webpack/perform-opt.html#六、使用输出分析工具" class="sidebar-link">六、使用输出分析工具</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/webpack/perform-opt.html#七、其他tips" class="sidebar-link">七、其他Tips</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack相关的性能优化"><a href="#webpack相关的性能优化" class="header-anchor">#</a> webpack相关的性能优化</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>Webpack是现在主流的功能强大的模块化打包工具，在使用Webpack时，如果不注意性能优化，有非常大的可能会产生性能问题，性能问题主要分为开发时打包构建速度慢、开发调试时的重复性工作、以及输出文件质量不高等，因此性能优化也主要从这些方面来分析。本文主要是根据自己的理解对《深入浅出Webpack》这本书进行总结，涵盖了大部分的优化方法，可以作为Webpack性能优化时的参考和检查清单。</p> <h2 id="一、优化构建速度"><a href="#一、优化构建速度" class="header-anchor">#</a> 一、优化构建速度</h2> <p>Webpack在启动后会根据Entry配置的入口出发，递归地解析所依赖的文件。这个过程分为搜索文件和把匹配的文件进行分析、转化的两个过程，因此可以从这两个角度来进行优化配置。</p> <h3 id="_1-1-缩小文件搜索范围"><a href="#_1-1-缩小文件搜索范围" class="header-anchor">#</a> 1.1 缩小文件搜索范围</h3> <p>搜索过程优化方式包括：</p> <h4 id="resolve字段告诉webpack怎么去搜索文件，所以首先要重视resolve字段的配置："><a href="#resolve字段告诉webpack怎么去搜索文件，所以首先要重视resolve字段的配置：" class="header-anchor">#</a> resolve字段告诉webpack怎么去搜索文件，所以首先要重视resolve字段的配置：</h4> <ol><li><p>设置resolve.modules:[path.resolve(__dirname, 'node_modules')]避免层层查找。
resolve.modules告诉webpack去哪些目录下寻找第三方模块，默认值为['node_modules']，会依次查找./node_modules、../node_modules、../../node_modules。</p></li> <li><p>设置resolve.mainFields:['main']，设置尽量少的值可以减少入口文件的搜索步骤
第三方模块为了适应不同的使用环境，会定义多个入口文件，mainFields定义使用第三方模块的哪个入口文件，由于大多数第三方模块都使用main字段描述入口文件的位置，所以可以设置单独一个main值，减少搜索</p></li> <li><p>对庞大的第三方模块设置resolve.alias, 使webpack直接使用库的min文件，避免库内解析
如对于react:</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>resolve<span class="token punctuation">.</span>alias<span class="token operator">:</span><span class="token punctuation">{</span>
	<span class="token string">'react'</span><span class="token operator">:</span>patch<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/react/dist/react.min.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样会影响Tree-Shaking，适合对整体性比较强的库使用，如果是像lodash这类工具类的比较分散的库，比较适合Tree-Shaking，避免使用这种方式。</p> <ol start="4"><li>合理配置resolve.extensions，减少文件查找
默认值：extensions:['.js', '.json'],当导入语句没带文件后缀时，Webpack会根据extensions定义的后缀列表进行文件查找，所以：</li></ol> <ul><li>列表值尽量少</li> <li>频率高的文件类型的后缀写在前面</li> <li>源码中的导入语句尽可能的写上文件后缀，如require(./data)要写成require(./data.json)</li></ul> <h4 id="module-noparse字段告诉webpack不必解析哪些文件，可以用来排除对非模块化库文件的解析"><a href="#module-noparse字段告诉webpack不必解析哪些文件，可以用来排除对非模块化库文件的解析" class="header-anchor">#</a> module.noParse字段告诉Webpack不必解析哪些文件，可以用来排除对非模块化库文件的解析</h4> <p>如jQuery、ChartJS，另外如果使用resolve.alias配置了react.min.js，则也应该排除解析，因为react.min.js经过构建，已经是可以直接运行在浏览器的、非模块化的文件了。noParse值可以是RegExp、[RegExp]、function</p> <p>module:{ noParse:[/jquery|chartjs/, /react.min.js$/] }</p> <h4 id="配置loader时，通过test、exclude、include缩小搜索范围"><a href="#配置loader时，通过test、exclude、include缩小搜索范围" class="header-anchor">#</a> 配置loader时，通过test、exclude、include缩小搜索范围</h4> <h3 id="_1-2-使用dllplugin减少基础模块编译次数"><a href="#_1-2-使用dllplugin减少基础模块编译次数" class="header-anchor">#</a> 1.2 使用DllPlugin减少基础模块编译次数</h3> <p>DllPlugin动态链接库插件，其原理是把网页依赖的基础模块抽离出来打包到dll文件中，当需要导入的模块存在于某个dll中时，这个模块不再被打包，而是去dll中获取。**为什么会提升构建速度呢？**原因在于dll中大多包含的是常用的第三方模块，如react、react-dom，所以只要这些模块版本不升级，就只需被编译一次。我认为这样做和配置resolve.alias和module.noParse的效果有异曲同工的效果。</p> <p>使用方法：</p> <ol><li>使用DllPlugin配置一个webpack_dll.config.js来构建dll文件：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack_dll.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DllPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 entry<span class="token operator">:</span><span class="token punctuation">{</span>
     react<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token string">'react-dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     polyfill<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'core-js/fn/promise'</span><span class="token punctuation">,</span><span class="token string">'whatwg-fetch'</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 output<span class="token operator">:</span><span class="token punctuation">{</span>
     filename<span class="token operator">:</span><span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
     path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     library<span class="token operator">:</span><span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>  <span class="token comment">//dll的全局变量名</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 plugins<span class="token operator">:</span><span class="token punctuation">[</span>
     <span class="token keyword">new</span> <span class="token class-name">DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         name<span class="token operator">:</span><span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>  <span class="token comment">//dll的全局变量名</span>
         path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">,</span><span class="token string">'[name].manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//描述生成的manifest文件</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>需要注意DllPlugin的参数中name值必须和output.library值保持一致，并且生成的manifest文件中会引用output.library值。</p> <p>最终构建出的文件：</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">|</span><span class="token operator">--</span> polyfill<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
 <span class="token operator">|</span><span class="token operator">--</span> polyfill<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>json
 <span class="token operator">|</span><span class="token operator">--</span> react<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
 └── react<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>json
</code></pre></div><p>其中xx.dll.js包含打包的n多模块，这些模块存在一个数组里，并以数组索引作为ID，通过一个变量假设为_xx_dll暴露在全局中，可以通过window._xx_dll访问这些模块。xx.manifest.json文件描述dll文件包含哪些模块、每个模块的路径和ID。然后再在项目的主config文件里使用DllReferencePlugin插件引入xx.manifest.json文件。</p> <ol start="2"><li>在主config文件里使用DllReferencePlugin插件引入xx.manifest.json文件：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//webpack.config.json</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DllReferencePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllReferencePlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token punctuation">{</span> main<span class="token operator">:</span><span class="token string">'./main.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//... 省略output、loader等的配置</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            manifest<span class="token operator">:</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/react.manifest.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">DllReferenctPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            manifest<span class="token operator">:</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/polyfill.manifest.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最终构建生成main.js</p> <h3 id="_1-3-使用happypack开启多进程loader转换"><a href="#_1-3-使用happypack开启多进程loader转换" class="header-anchor">#</a> 1.3 使用HappyPack开启多进程Loader转换</h3> <p>在整个构建流程中，最耗时的就是Loader对文件的转换操作了，而运行在Node.js之上的Webpack是单线程模型的，也就是只能一个一个文件进行处理，不能并行处理。HappyPack可以将任务分解给多个子进程，最后将结果发给主进程。JS是单线程模型，只能通过这种多进程的方式提高性能。</p> <p>HappyPack使用如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> happypack
<span class="token comment">// webpack.config.json</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token operator">/</span>\<span class="token punctuation">.</span>js$<span class="token operator">/</span>，
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'happypack/loader?id=babel'</span><span class="token punctuation">]</span>
                exclude<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.css/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'happypack/loader?id=css'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                id<span class="token operator">:</span><span class="token string">'babel'</span><span class="token punctuation">,</span>
                loaders<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                id<span class="token operator">:</span><span class="token string">'css'</span><span class="token punctuation">,</span>
                loaders<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>除了id和loaders，HappyPack还支持这三个参数：threads、verbose、threadpool，threadpool代表共享进程池，即多个HappyPack实例都用同个进程池中的子进程处理任务，以防资源占用过多。</p> <h3 id="_1-4-使用paralleluglifyplugin开启多进程压缩js文件"><a href="#_1-4-使用paralleluglifyplugin开启多进程压缩js文件" class="header-anchor">#</a> 1.4 使用ParallelUglifyPlugin开启多进程压缩JS文件</h3> <p>使用UglifyJS插件压缩JS代码时，需要先将代码解析成Object表示的AST（抽象语法树），再去应用各种规则去分析和处理AST，所以这个过程计算量大耗时较多。ParallelUglifyPlugin可以开启多个子进程，每个子进程使用UglifyJS压缩代码，可以并行执行，能显著缩短压缩时间。
使用也很简单，把原来的UglifyJS插件换成本插件即可，使用如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> webpack<span class="token operator">-</span>parallel<span class="token operator">-</span>uglify<span class="token operator">-</span>plugin

<span class="token comment">// webpack.config.json</span>
<span class="token keyword">const</span> ParallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'wbepack-parallel-uglify-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        uglifyJS<span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token comment">//...这里放uglifyJS的参数</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">//...其他ParallelUglifyPlugin的参数，设置cacheDir可以开启缓存，加快构建速度</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="二、优化开发体验"><a href="#二、优化开发体验" class="header-anchor">#</a> 二、优化开发体验</h2> <p>开发过程中修改源码后，需要自动构建和刷新浏览器，以查看效果。这个过程可以使用Webpack实现自动化，Webpack负责监听文件的变化，DevServer负责刷新浏览器。</p> <h3 id="_2-1-使用自动刷新"><a href="#_2-1-使用自动刷新" class="header-anchor">#</a> 2.1 使用自动刷新</h3> <h4 id="_2-1-1-webpack监听文件"><a href="#_2-1-1-webpack监听文件" class="header-anchor">#</a> 2.1.1 Webpack监听文件</h4> <p>Webpack可以使用两种方式开启监听：1. 启动webpack时加上--watch参数；2. 在配置文件中设置watch:true。此外还有如下配置参数。合理设置watchOptions可以优化监听体验。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        ignored<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        aggregateTimeout<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>  <span class="token comment">//文件变动后多久发起构建，越大越好</span>
        poll<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment">//每秒询问次数，越小越好</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ignored：设置不监听的目录，排除node_modules后可以显著减少Webpack消耗的内存</p> <p>aggregateTimeout：文件变动后多久发起构建，避免文件更新太快而造成的频繁编译以至卡死，越大越好</p> <p>poll：通过向系统轮询文件是否变化来判断文件是否改变，poll为每秒询问次数，越小越好</p> <h4 id="_2-1-2-devserver刷新浏览器"><a href="#_2-1-2-devserver刷新浏览器" class="header-anchor">#</a> 2.1.2 DevServer刷新浏览器</h4> <p>DevServer刷新浏览器有两种方式：</p> <ol><li>向网页中注入代理客户端代码，通过客户端发起刷新</li> <li>向网页装入一个iframe，通过刷新iframe实现刷新效果</li></ol> <p>默认情况下，以及 devserver: {inline:true} 都是采用第一种方式刷新页面。第一种方式DevServer因为不知道网页依赖哪些Chunk，所以会向每个chunk中都注入客户端代码，当要输出很多chunk时，会导致构建变慢。而一个页面只需要一个客户端，所以关闭inline模式可以减少构建时间，chunk越多提升月明显。关闭方式：</p> <ol><li>启动时使用webpack-dev-server --inline false</li> <li>配置 devserver:{inline:false}</li></ol> <p>关闭inline后入口网址变为http://localhost:8080/webpack-dev-server/</p> <p>另外devServer.compress 参数可配置是否采用Gzip压缩，默认为false</p> <h3 id="_2-2-开启模块热替换hmr"><a href="#_2-2-开启模块热替换hmr" class="header-anchor">#</a> 2.2 开启模块热替换HMR</h3> <p>模块热替换不刷新整个网页而只重新编译发生变化的模块，并用新模块替换老模块，所以预览反应更快，等待时间更少，同时不刷新页面能保留当前网页的运行状态。原理也是向每一个chunk中注入代理客户端来连接DevServer和网页。开启方式：</p> <ol><li>webpack-dev-server --hot</li> <li>使用HotModuleReplacementPlugin，比较麻烦</li></ol> <p>开启后如果修改子模块就可以实现局部刷新，但如果修改的是根JS文件，会整页刷新，原因在于，子模块更新时，事件一层层向上传递，直到某层的文件接收了当前变化的模块，然后执行回调函数。如果一层层向外抛直到最外层都没有文件接收，就会刷新整页。
使用 NamedModulesPlugin 可以使控制台打印出被替换的模块的名称而非数字ID，另外同webpack监听，忽略node_modules目录的文件可以提升性能。</p> <h2 id="三、优化输出质量-压缩文件体积"><a href="#三、优化输出质量-压缩文件体积" class="header-anchor">#</a> 三、优化输出质量-压缩文件体积</h2> <h3 id="_3-1-区分环境-减小生产环境代码体积"><a href="#_3-1-区分环境-减小生产环境代码体积" class="header-anchor">#</a> 3.1 区分环境--减小生产环境代码体积</h3> <p>代码运行环境分为开发环境和生产环境，代码需要根据不同环境做不同的操作，许多第三方库中也有大量的根据开发环境判断的if else代码，构建也需要根据不同环境输出不同的代码，所以需要一套机制可以在源码中区分环境，区分环境之后可以使输出的生产环境的代码体积减小。Webpack中使用DefinePlugin插件来定义配置文件适用的环境。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> DefinePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DefinePlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'process.env'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'production'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>注意，JSON.stringify('production') 的原因是，环境变量值需要一个双引号包裹的字符串，而stringify后的值是'&quot;production&quot;'</p> <p>然后就可以在源码中使用定义的环境：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你在生产环境'</span><span class="token punctuation">)</span>
    <span class="token function">doSth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你在开发环境'</span><span class="token punctuation">)</span>
    <span class="token function">doSthElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当代码中使用了process时，Webpack会自动打包进process模块的代码以支持非Node.js的运行环境，这个模块的作用是模拟Node.js中的process，以支持process.env.NODE_ENV === 'production' 语句。</p> <h3 id="_3-2-压缩代码-js、es、css"><a href="#_3-2-压缩代码-js、es、css" class="header-anchor">#</a> 3.2 压缩代码-JS、ES、CSS</h3> <h4 id="压缩js：webpack内置uglifyjs插件、paralleluglifyplugin"><a href="#压缩js：webpack内置uglifyjs插件、paralleluglifyplugin" class="header-anchor">#</a> 压缩JS：Webpack内置UglifyJS插件、ParallelUglifyPlugin</h4> <p>会分析JS代码语法树，理解代码的含义，从而做到去掉无效代码、去掉日志输入代码、缩短变量名等优化。常用配置参数如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> UglifyJSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/optimize/UglifyJsPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        compress<span class="token operator">:</span> <span class="token punctuation">{</span>
            warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">//删除无用代码时不输出警告</span>
            drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//删除所有console语句，可以兼容IE</span>
            collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//内嵌已定义但只使用一次的变量</span>
            reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//提取使用多次但没定义的静态值到变量</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
            beautify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//最紧凑的输出，不保留空格和制表符</span>
            comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//删除所有注释</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>使用webpack --optimize-minimize 启动webpack，可以注入默认配置的UglifyJSPlugin</p> <h4 id="压缩es6：第三方uglifyjs插件"><a href="#压缩es6：第三方uglifyjs插件" class="header-anchor">#</a> 压缩ES6：第三方UglifyJS插件</h4> <p>随着越来越多的浏览器支持直接执行ES6代码，应尽可能的运行原生ES6，这样比起转换后的ES5代码，代码量更少，且ES6代码性能更好。直接运行ES6代码时，也需要代码压缩，第三方的uglify-webpack-plugin提供了压缩ES6代码的功能：</p> <div class="language-js extra-class"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> uglify<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin@beta <span class="token comment">//要使用最新版本的插件</span>
<span class="token comment">//webpack.config.json</span>
<span class="token keyword">const</span> UglifyESPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglify-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyESPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        uglifyOptions<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">//比UglifyJS多嵌套一层</span>
            compress<span class="token operator">:</span> <span class="token punctuation">{</span>
                warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            output<span class="token operator">:</span> <span class="token punctuation">{</span>
                beautify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                comments<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>另外要防止babel-loader转换ES6代码，要在.babelrc中去掉babel-preset-env，因为正是babel-preset-env负责把ES6转换为ES5。</p> <h4 id="压缩css：css-loader-minimize、purifycssplugin"><a href="#压缩css：css-loader-minimize、purifycssplugin" class="header-anchor">#</a> 压缩CSS：css-loader?minimize、PurifyCSSPlugin</h4> <p>cssnano基于PostCSS，不仅是删掉空格，还能理解代码含义，例如把color:#ff0000 转换成 color:red，css-loader内置了cssnano，只需要使用 css-loader?minimize 就可以开启cssnano压缩。</p> <p>另外一种压缩CSS的方式是使用PurifyCSSPlugin，需要配合 extract-text-webpack-plugin 使用，它主要的作用是可以去除没有用到的CSS代码，类似JS的Tree Shaking。</p> <h3 id="_3-3-使用tree-shaking剔除js死代码"><a href="#_3-3-使用tree-shaking剔除js死代码" class="header-anchor">#</a> 3.3 使用Tree Shaking剔除JS死代码</h3> <p>Tree Shaking可以剔除用不上的死代码，它依赖ES6的import、export的模块化语法，最先在Rollup中出现，Webpack 2.0将其引入。适合用于Lodash、utils.js等工具类较分散的文件。它正常工作的前提是代码必须采用ES6的模块化语法，因为ES6模块化语法是静态的（在导入、导出语句中的路径必须是静态字符串，且不能放入其他代码块中）。如果采用了ES5中的模块化，例如module.export = {...}、require( x+y )、if (x) { require( './util' ) }，则Webpack无法分析出可以剔除哪些代码。</p> <p>启用Tree Shaking：</p> <ol><li>修改.babelrc以保留ES6模块化语句：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">{</span> <span class="token string">&quot;module&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token comment">//关闭Babel的模块转换功能，保留ES6模块化语法</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>启动webpack时带上 --display-used-exports可以在shell打印出关于代码剔除的提示</li> <li>使用UglifyJSPlugin，或者启动时使用--optimize-minimize</li> <li>在使用第三方库时，需要配置 resolve.mainFields: ['jsnext:main', 'main'] 以指明解析第三方库代码时，采用ES6模块化的代码入口</li></ol> <h2 id="四、优化输出质量-加速网络请求"><a href="#四、优化输出质量-加速网络请求" class="header-anchor">#</a> 四、优化输出质量--加速网络请求</h2> <h3 id="_4-1-使用cdn加速静态资源加载"><a href="#_4-1-使用cdn加速静态资源加载" class="header-anchor">#</a> 4.1 使用CDN加速静态资源加载</h3> <ol><li>CND加速的原理
CDN通过将资源部署到世界各地，使得用户可以就近访问资源，加快访问速度。要接入CDN，需要把网页的静态资源上传到CDN服务上，在访问这些资源时，使用CDN服务提供的URL。</li></ol> <p>由于CDN会为资源开启长时间的缓存，例如用户从CDN上获取了index.html，即使之后替换了CDN上的index.html，用户那边仍会在使用之前的版本直到缓存时间过期。业界做法：</p> <ul><li>HTML文件：放在自己的服务器上且关闭缓存，不接入CDN</li> <li>静态的JS、CSS、图片等资源：开启CDN和缓存，同时文件名带上由内容计算出的Hash值，这样只要内容变化hash就会变化，文件名就会变化，就会被重新下载而不论缓存时间多长。</li></ul> <p>另外，HTTP1.x版本的协议下，浏览器会对于向同一域名并行发起的请求数限制在4~8个。那么把所有静态资源放在同一域名下的CDN服务上就会遇到这种限制，所以可以把他们分散放在不同的CDN服务上，例如JS文件放在js.cdn.com下，将CSS文件放在css.cdn.com下等。这样又会带来一个新的问题：增加了域名解析时间，这个可以通过dns-prefetch来解决 <link rel="dns-prefetch" href="//js.cdn.com"> 来缩减域名解析的时间。形如//xx.com 这样的URL省略了协议，这样做的好处是，浏览器在访问资源时会自动根据当前URL采用的模式来决定使用HTTP还是HTTPS协议。</p> <p>总之，构建需要满足以下几点：</p> <ul><li>静态资源导入的URL要变成指向CDN服务的绝对路径的URL</li> <li>静态资源的文件名需要带上根据内容计算出的Hash值</li> <li>不同类型资源放在不同域名的CDN上</li></ul> <p>最终配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>WebPlugin<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'web-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
output<span class="token operator">:</span><span class="token punctuation">{</span>
 filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span><span class="token punctuation">,</span>
 path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 publicPatch<span class="token operator">:</span> <span class="token string">'//js.cdn.com/id/'</span><span class="token punctuation">,</span> <span class="token comment">//指定存放JS文件的CDN地址</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
module<span class="token operator">:</span><span class="token punctuation">{</span>
 rules<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
     test<span class="token operator">:</span> <span class="token regex">/\.css/</span><span class="token punctuation">,</span>
     use<span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'css-loader?minimize'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         publicPatch<span class="token operator">:</span> <span class="token string">'//img.cdn.com/id/'</span><span class="token punctuation">,</span> <span class="token comment">//指定css文件中导入的图片等资源存放的cdn地址</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.png/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'file-loader?name=[name]_[hash:8].[ext]'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//为输出的PNG文件名加上Hash值 </span>
 <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">WebPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     template<span class="token operator">:</span> <span class="token string">'./template.html'</span><span class="token punctuation">,</span>
     filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
     stylePublicPath<span class="token operator">:</span> <span class="token string">'//css.cdn.com/id/'</span><span class="token punctuation">,</span> <span class="token comment">//指定存放CSS文件的CDN地址</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     filename<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[name]_[contenthash:8].css</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">//为输出的CSS文件加上Hash</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="_4-2-多页面应用提取页面间公共代码，以利用缓存"><a href="#_4-2-多页面应用提取页面间公共代码，以利用缓存" class="header-anchor">#</a> 4.2 多页面应用提取页面间公共代码，以利用缓存</h3> <ol><li><p>原理
大型网站通常由多个页面组成，每个页面都是一个独立的单页应用，多个页面间肯定会依赖同样的样式文件、技术栈等。如果不把这些公共文件提取出来，那么每个单页打包出来的chunk中都会包含公共代码，相当于要传输n份重复代码。如果把公共文件提取出一个文件，那么当用户访问了一个网页，加载了这个公共文件，再访问其他依赖公共文件的网页时，就直接使用文件在浏览器的缓存，这样公共文件就只用被传输一次。</p></li> <li><p>应用方法
(1) 把多个页面依赖的公共代码提取到common.js中，此时common.js包含基础库的代码</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> CommonsChunkPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/optimize/CommonsChunkPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        chunks<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//从哪些chunk中提取</span>
        name<span class="token operator">:</span><span class="token string">'common'</span><span class="token punctuation">,</span>  <span class="token comment">// 提取出的公共部分形成一个新的chunk</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>(2) 找出依赖的基础库，写一个base.js文件，再与common.js提取公共代码到base中，common.js就剔除了基础库代码，而base.js保持不变</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//base.js</span>
<span class="token keyword">import</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./base.css'</span><span class="token punctuation">;</span>
<span class="token comment">//webpack.config.json</span>
entry<span class="token operator">:</span><span class="token punctuation">{</span>
    base<span class="token operator">:</span> <span class="token string">'./base.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        chunks<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'base'</span><span class="token punctuation">,</span><span class="token string">'common'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span><span class="token string">'base'</span><span class="token punctuation">,</span>
        <span class="token comment">//minChunks:2, 表示文件要被提取出来需要在指定的chunks中出现的最小次数，防止common.js中没有代码的情况</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>        
<span class="token punctuation">]</span>
</code></pre></div><p>(3) 得到基础库代码base.js，不含基础库的公共代码common.js，和页面各自的代码文件xx.js。
页面引用顺序如下：base.js--&gt; common.js--&gt; xx.js</p> <h3 id="_4-3-分割代码以按需加载"><a href="#_4-3-分割代码以按需加载" class="header-anchor">#</a> 4.3 分割代码以按需加载</h3> <ol><li>原理
单页应用的一个问题在于使用一个页面承载复杂的功能，要加载的文件体积很大，不进行优化的话会导致首屏加载时间过长，影响用户体验。做按需加载可以解决这个问题。具体方法如下：</li></ol> <p>（1）将网站功能按照相关程度划分成几类</p> <p>（2）每一类合并成一个Chunk，按需加载对应的Chunk</p> <p>（3）例如，只把首屏相关的功能放入执行入口所在的Chunk，这样首次加载少量的代码，其他代码要用到的时候再去加载。最好提前预估用户接下来的操作，提前加载对应代码，让用户感知不到网络加载</p> <ol start="2"><li>做法
一个最简单的例子：网页首次只加载main.js，网页展示一个按钮，点击按钮时加载分割出去的show.js，加载成功后执行show.js里的函数</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//main.js</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName:&quot;show&quot; */</span> <span class="token string">'./show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">show</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">show</span><span class="token punctuation">(</span><span class="token string">'Webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//show.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello '</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>import(/* webpackChunkName:show */ './show').then() 是实现按需加载的关键，Webpack内置对import( <em>)语句的支持，Webpack会以./show.js为入口重新生成一个Chunk。代码在浏览器上运行时只有点击了按钮才会开始加载show.js，且import语句会返回一个Promise，加载成功后可以在then方法中获取加载的内容。这要求浏览器支持Promise API，对于不支持的浏览器，需要注入Promise polyfill。/</em> webpackChunkName:show */ 是定义动态生成的Chunk的名称，默认名称是[id].js，定义名称方便调试代码。为了正确输出这个配置的ChunkName，还需要配置Webpack：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//...</span>
output<span class="token operator">:</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    chunkFilename<span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span> <span class="token comment">//指定动态生成的Chunk在输出时的文件名称</span>
<span class="token punctuation">}</span>
</code></pre></div><p>书中另外提供了更复杂的React-Router中异步加载组件的实战场景。P212</p> <h2 id="五、优化输出质量-提升代码运行时的效率"><a href="#五、优化输出质量-提升代码运行时的效率" class="header-anchor">#</a> 五、优化输出质量--提升代码运行时的效率</h2> <h3 id="_5-1-使用prepack提前求值"><a href="#_5-1-使用prepack提前求值" class="header-anchor">#</a> 5.1 使用Prepack提前求值</h3> <ol><li><p>原理：
Prepack是一个部分求值器，编译代码时提前将计算结果放到编译后的代码中，而不是在代码运行时才去求值。通过在便一阶段预先执行源码来得到执行结果，再直接将运行结果输出以提升性能。但是现在Prepack还不够成熟，用于线上环境还为时过早。</p></li> <li><p>使用方法</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> PrepackWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'prepack-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">PrepackWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-2-使用scope-hoisting"><a href="#_5-2-使用scope-hoisting" class="header-anchor">#</a> 5.2 使用Scope Hoisting</h3> <ol><li><p>原理
译作“作用域提升”，是在Webpack3中推出的功能，它分析模块间的依赖关系，尽可能将被打散的模块合并到一个函数中，但不能造成代码冗余，所以只有被引用一次的模块才能被合并。由于需要分析模块间的依赖关系，所以源码必须是采用了ES6模块化的，否则Webpack会降级处理不采用Scope Hoisting。</p></li> <li><p>使用方法</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ModuleConcatenationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/optimize/ModuleConcatenationPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleConcatenationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
resolve<span class="token operator">:</span><span class="token punctuation">{</span>
    mainFields<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'jsnext:main'</span><span class="token punctuation">,</span><span class="token string">'browser'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>webpack --display-optimization-bailout 输出日志中会提示哪个文件导致了降级处理</p> <h2 id="六、使用输出分析工具"><a href="#六、使用输出分析工具" class="header-anchor">#</a> 六、使用输出分析工具</h2> <p>启动Webpack时带上这两个参数可以生成一个json文件，输出分析工具大多依赖该文件进行分析：</p> <p>webpack --profile --json &gt; stats.json 其中 --profile 记录构建过程中的耗时信息，--json 以JSON的格式输出构建结果，&gt;stats.json 是UNIX / Linux系统中的管道命令，含义是将内容通过管道输出到stats.json文件中。</p> <ol><li><p>官方工具Webpack Analyse
打开该工具的官网hthttp://webpack.github.io/analyse/%E4%B8%8A%E4%BC%A0stats.json，就可以得到分析结果</p></li> <li><p>webpack-bundle-analyzer</p></li></ol> <p>可视化分析工具，比Webapck Analyse更直观。使用也很简单：</p> <p>(1) npm i -g webpack-bundle-analyzer安装到全局
(2) 按照上面方法生成stats.json文件
(3) 在项目根目录执行webpack-bundle-analyzer ，浏览器会自动打开结果分析页面。</p> <h2 id="七、其他tips"><a href="#七、其他tips" class="header-anchor">#</a> 七、其他Tips</h2> <ol><li>配置babel-loader时，use: [‘babel-loader?cacheDirectory’] cacheDirectory用于缓存babel的编译结果，加快重新编译的速度。另外注意排除node_modules文件夹，因为文件都使用了ES5的语法，没必要再使用Babel转换。</li> <li>配置externals，排除因为已使用<script></script></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.99d67ef5.js" defer></script><script src="/blog/assets/js/2.3ca9670a.js" defer></script><script src="/blog/assets/js/50.c5dfcbcf.js" defer></script>
  </body>
</html>
