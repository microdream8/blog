<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入浅出前端脚手架 | wecode 前端团队</title>
    <meta name="description" content="致力于利用科技的力量，让孩子们学习编程的过程更轻松、更有趣！">
    <link rel="icon" href="favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f54d1925.css" as="style"><link rel="preload" href="/blog/assets/js/app.1a5a821a.js" as="script"><link rel="preload" href="/blog/assets/js/2.97287b3e.js" as="script"><link rel="preload" href="/blog/assets/js/3.0a84591e.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.1d249f81.js"><link rel="prefetch" href="/blog/assets/js/11.dad66d2a.js"><link rel="prefetch" href="/blog/assets/js/12.08568b0c.js"><link rel="prefetch" href="/blog/assets/js/13.485fd656.js"><link rel="prefetch" href="/blog/assets/js/14.8039202f.js"><link rel="prefetch" href="/blog/assets/js/15.7bdec6de.js"><link rel="prefetch" href="/blog/assets/js/16.70819ddc.js"><link rel="prefetch" href="/blog/assets/js/17.389e3783.js"><link rel="prefetch" href="/blog/assets/js/18.dec25dbb.js"><link rel="prefetch" href="/blog/assets/js/19.2d3d81a7.js"><link rel="prefetch" href="/blog/assets/js/20.5c333605.js"><link rel="prefetch" href="/blog/assets/js/4.9579e427.js"><link rel="prefetch" href="/blog/assets/js/5.e3b12a34.js"><link rel="prefetch" href="/blog/assets/js/6.724b03ad.js"><link rel="prefetch" href="/blog/assets/js/7.31fe8f25.js"><link rel="prefetch" href="/blog/assets/js/8.21370cd0.js"><link rel="prefetch" href="/blog/assets/js/9.c02cccef.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f54d1925.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">wecode 前端团队</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/share/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/blog/share/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-note.html" class="nav-link">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">深入scratch</a></li><li class="dropdown-item"><!----> <a href="/blog/share/wechat.html" class="nav-link">公众号开发总结</a></li><li class="dropdown-item"><!----> <a href="/blog/share/scaffold.html" class="nav-link router-link-exact-active router-link-active">深入浅出前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/share/md.html" class="nav-link">markdown语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/en/webpack.html" class="nav-link">webpack 英文文档学习</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/wecode-fe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/share/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/blog/share/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-note.html" class="nav-link">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">深入scratch</a></li><li class="dropdown-item"><!----> <a href="/blog/share/wechat.html" class="nav-link">公众号开发总结</a></li><li class="dropdown-item"><!----> <a href="/blog/share/scaffold.html" class="nav-link router-link-exact-active router-link-active">深入浅出前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/blog/share/md.html" class="nav-link">markdown语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/en/webpack.html" class="nav-link">webpack 英文文档学习</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/wecode-fe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入浅出前端脚手架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/share/scaffold.html#什么是脚手架-？" class="sidebar-link">什么是脚手架 ？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/scaffold.html#为什么要用脚手架-？" class="sidebar-link">为什么要用脚手架 ？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/scaffold.html#优秀的脚手架应该具备以下几要素" class="sidebar-link">优秀的脚手架应该具备以下几要素</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/scaffold.html#开发前准备工作" class="sidebar-link">开发前准备工作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/scaffold.html#开始搭建脚手架" class="sidebar-link">开始搭建脚手架</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/scaffold.html#别慌，未完待续～" class="sidebar-link">别慌，未完待续～</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="scaffold-脚手架-cli"><a href="#scaffold-脚手架-cli" aria-hidden="true" class="header-anchor">#</a> scaffold 脚手架-cli</h1> <blockquote><p>本文主要讲解什么是脚手架、作用以及仿vue-cli搭建属于自己的脚手架，目标是实现一个 cli init template-name project-name 这样的命令</p></blockquote> <h2 id="什么是脚手架-？"><a href="#什么是脚手架-？" aria-hidden="true" class="header-anchor">#</a> 什么是脚手架 ？</h2> <p><strong>scaffold</strong> ：[ˈskæfoʊld]    中式发音：丝盖否的<br>
简单的说脚手架是属于建筑时用到的一种工具，为安全施工、方便施工而搭建的工作平台（铁架子）。<br>
程序开发引入的脚手架也是开发工具的一种，业内称为<font color="red"><strong>CLI</strong></font>，定位基本一致：<strong>创建项目初始文件</strong>,本质是从远程下载一个模板来进行一个新项目,可理解为高级版的克隆，它主要是提供了交互式的命令让我们可以动态的更改模板，然后用一句命令就可以一劳永逸了。<br>
例如常见的 <font color="red">vue-cli</font> 、<font color="red">create-react-app</font> 、<font color="red">react-native-cli</font>等。</p> <h2 id="为什么要用脚手架-？"><a href="#为什么要用脚手架-？" aria-hidden="true" class="header-anchor">#</a> 为什么要用脚手架 ？</h2> <p>1、快速搭建项目模板<br>
2、减少重复性工作，提升开发效率和开发舒适性<br>
3、多人协作更为方便，不需要把文件传来传去<br></p> <h2 id="优秀的脚手架应该具备以下几要素"><a href="#优秀的脚手架应该具备以下几要素" aria-hidden="true" class="header-anchor">#</a> 优秀的脚手架应该具备以下几要素</h2> <p>1、丰富但不繁琐的配置项；<br>
2、与其他功能模块联动，生成对应的基本配置项；<br>
3、自动安装依赖；<br>
4、底层的高度可扩展性；<br>
5、支持多种运行环境，比如命令行和Node.js API<br></p> <h2 id="开发前准备工作"><a href="#开发前准备工作" aria-hidden="true" class="header-anchor">#</a> 开发前准备工作</h2> <ul><li><h4 id="思路-（借鉴-vue-cli）"><a href="#思路-（借鉴-vue-cli）" aria-hidden="true" class="header-anchor">#</a> 思路 （借鉴 vue-cli）</h4> <p>vue-cli 是将项目模板放在 git 上，运行的时候再根据用户交互下载不同的模板，经过模板引擎渲染出来，生成项目。这样将模板和脚手架分离，就可以各自维护，即使模板有变动，只需要上传最新的模板即可，而不需要用户去更新脚手架就可以生成最新的项目。那么就可以按照这个思路来进行开发了。</p></li> <li><h4 id="使用的工具库"><a href="#使用的工具库" aria-hidden="true" class="header-anchor">#</a> 使用的工具库</h4> <p>1、<font color="red"><strong>NodeJs</strong></font><br></p> <blockquote><p>还不了解nodejs的请点击浏览器右上角或左上角关闭按钮。。。不送😂<br></p></blockquote> <p>2、<font color="red"><strong>commander.js</strong></font>：可以自动的解析命令和参数，用于处理用户输入的命令。<br></p> <blockquote><p>回忆一下，我们曾用过的 vue init 的命令就是这样声明的。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;commander&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义指令</span>
program
  <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">'0.0.1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token string">'Generate a new project from a template'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 回调函数</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 解析命令行参数</span>
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3、<font color="red"><strong>download-git-repo</strong></font>：下载并提取 git 仓库，用于下载项目模板。<br></p> <blockquote><p>这是用来下载远程模板的，支持 GitHub、 GitLab 和 Bitbucket 等，用法如下：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span>
<span class="token function">download</span><span class="token punctuation">(</span>repository<span class="token punctuation">,</span> destination<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token comment">/*
**  repository : 远程仓库地址
**  destination : 存放下载的文件路径,也可以直接写文件名，默认就是当前目录
**  options : 一些选项 
**            比如 { clone：boolean } 表示用 http download 还是 git clone 的形式下载
*/</span>
</code></pre></div><p>4、<font color="red"><strong>inquirer.js</strong></font>：通用的命令行用户界面集合，用于和用户进行交互。<br></p> <blockquote><p>想象一下我们用 vue init webpack project-name 之后是不是会有几个交互问题，问你文件名啊、<br>
作者啊、描述啊、要不要用 eslint 啊等等之类的，就是用这个来写的</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
inquirer
  <span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 一些交互式的问题</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 回调函数，answers 就是用户输入的内容，是个对象</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>5、<font color="red"><strong>ora</strong></font>：下载过程久的话，可以用于显示下载中的动画效果。<br></p> <blockquote><p>这是一个好看的加载，就是你下载的时候会有个转圈圈的那种效果，用法如下：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">'downloading template ...'</span><span class="token punctuation">)</span>
spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>6、<font color="red"><strong>chalk</strong></font>：可以给终端的字体加上颜色。<br></p> <blockquote><p>这是用来修改控制台输出内容样式的，比如颜色啊，具体用法如下：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="开始搭建脚手架"><a href="#开始搭建脚手架" aria-hidden="true" class="header-anchor">#</a> 开始搭建脚手架</h2> <blockquote><p>ok，有了上面的知识储备之后，我们就正式开始撸了。</p></blockquote></li> <li><h4 id="第一步：目录搭建"><a href="#第一步：目录搭建" aria-hidden="true" class="header-anchor">#</a> 第一步：目录搭建</h4> <blockquote><p>注意<font color="red"> #!/usr/bin/env node </font>这句话不要遗漏，详情如下：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token number">1.</span>首先我们要创建一个文件夹，并取名叫 xr<span class="token operator">-</span>cli；

    <span class="token number">2.</span>在该目录下执行 npm init 命令，一路回车，就会生成一个生成 <span class="token keyword">package</span><span class="token punctuation">.</span>json 文件，
      在 <span class="token keyword">package</span><span class="token punctuation">.</span>json 里面写入以下依赖并执行 npm install 安装，如下：
        <span class="token string">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;chalk&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.4.2&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;commander&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.19.0&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;download-git-repo&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^1.1.0&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;inquirer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^6.2.2&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;ora&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.0&quot;</span>
        <span class="token punctuation">}</span>

    <span class="token number">3.</span>新建一个 bin 文件夹，并在 bin 目录下新建一个无后缀名的 xr 文件，并写上：
        #<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/*
      ** 这个文件就是我们整个脚手架的入口文件，我们用 node ./bin/xr 运行一下，可打印出 hello
      ** 这里要注意开头的 #!/usr/bin/env node 这个语句必须加上，主要是为了让系统看到这一行
      ** 的时候，会沿着该路径去查找 node 并执行，主要是为了兼容 Mac ，确保可执行。
      */</span> 
</code></pre></div></li> <li><h4 id="第二步：bin-目录初始化"><a href="#第二步：bin-目录初始化" aria-hidden="true" class="header-anchor">#</a> 第二步：bin 目录初始化</h4> <p>当前，bin 目录下就只有一个文件，就是入口文件 xr。所以现在我们先来编写这个文件，由于内容较少，我们直接看代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>  #<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
  <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>

  <span class="token comment">// 定义当前版本</span>
  <span class="token comment">// 定义使用方法</span>
  <span class="token comment">// 定义四个指令</span>
  program
    <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">'&lt;command&gt; [options]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">'add a new template'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'delete a template'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">,</span> <span class="token string">'list all the templates'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token string">'generate a new project from a template'</span><span class="token punctuation">)</span>
    
  <span class="token comment">// 解析命令行参数</span>
  program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
</code></pre></div><p>这个文件的主要作用就是定义指令，现在我们用 node ./bin/xr 运行一下，就能看到如下结果：</p> <img src="/blog/assets/img/1.8abcc256.png" style="width:80%;"> <p>当然，你可能会觉得每次输入 node ./bin/xr 这个命令有点麻烦，没关系，我们可以在 package.json 里面写入已下内容：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// bin 用来指定每个命令所对应的可执行文件的位置</span>
  <span class="token string">&quot;bin&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;xr&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bin/xr&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>然后在根目录下执行 npm link（就是把命令挂载到全局的意思），这样我们每次只要输入 xr，就可以直接运行了，就像下面这样：</p> <img src="/blog/assets/img/2.675f2565.png" style="width:80%;"> <p>是不是好像有点样子了呢😁😁😁，那就让我们继续完善下 bin 目录吧！ok，让我们在 bin 目录下再新建四个文件，分别对应上面的四个指令，然后分别处理四个指令要做的事情，如下图：</p> <img src="/blog/assets/img/3.93a60e11.png" style="width:30%;"> <p>同样的，我们修改一下 package.json 里面的 bin 内容，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token string">&quot;bin&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;xr&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bin/xr&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;xr-add&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bin/xr-add&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;xr-delete&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bin/xr-delete&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;xr-list&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bin/xr-list&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;xr-init&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bin/xr-init&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>然后执行 npm unlink 解绑全局命令，再执行 npm link 重新把命令绑定到全局，就像下面这样：</p> <img src="/blog/assets/img/4.8815026b.png" style="width:80%;"> <p>最后顺便在根目录下新建一个 <font color="red"><strong>template.json</strong></font> 文件，里面的内容就是一个 <font color="red"><strong>{}</strong></font>。</p></li> <li><h4 id="第三步：编写具体指令"><a href="#第三步：编写具体指令" aria-hidden="true" class="header-anchor">#</a> 第三步：编写具体指令</h4> <blockquote><p>好了，一切准备就绪，接下来就让我们来写下具体的四个指令吧。</p></blockquote> <p><strong>1、编写xr-add文件：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token comment">// 交互式命令行</span>
<span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span>
<span class="token comment">// 修改控制台字符串的样式</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token comment">// node 内置文件模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 读取根目录下的 template.json</span>
<span class="token keyword">const</span> tplObj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../template</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token comment">// 自定义交互式命令行的问题及简单的校验</span>
<span class="token keyword">let</span> question <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">&quot;请输入模板名称&quot;</span><span class="token punctuation">,</span>
    <span class="token function">validate</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'Name is required!'</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tplObj<span class="token punctuation">[</span>val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'Template has already existed!'</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;url&quot;</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">&quot;请输入模板地址&quot;</span><span class="token punctuation">,</span>
    <span class="token function">validate</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'The url is required!'</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>question<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// answers 就是用户输入的内容，是个对象</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> answers<span class="token punctuation">;</span>
  <span class="token comment">// 过滤 unicode 字符</span>
  tplObj<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[\u0000-\u0019]/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token comment">// 把模板信息写入 template.json 文件中</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../template.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tplObj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">'Added successfully!\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">grey</span><span class="token punctuation">(</span><span class="token string">'The latest template list is: \n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tplObj<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这个文件主要目的就是添加模板并存储起来，上面的注释应该都写的挺清楚了。我们执行 xr add 来看看效果：</p> <img src="/blog/assets/img/5.d1a0c896.png" style="width:60%;"> <p>这里的模板名称（自己随便取）相当于 <font color="red"><strong>vue init webpack project-name</strong></font> 当中的 <font color="red"><strong>webpack</strong></font>；模板地址要注意一下，像下面这样写就可以，这里以 github 为例：</p> <img src="/blog/assets/img/6.8265a5ef.png" style="width:80%;"> <p>这里补充一下 <font color="red">xr add</font> 怎么对应到 xr-add 的：<br>
我们前面在定义 <font color="red">program.command('add').action(() =&gt; {})</font> 的时候没有写 action 这个回调函数，而当我们执行 <font color="red">xr add</font> 的时候，commander 会尝试在入口脚本的目录中搜索可执行文件，找到形如 <font color="red">program-command</font>（这里就是 <font color="red">xr add</font>）的命令来执行，大概这么个意思，下面命令也是一样的道理。.</p> <p><strong>2、编写xr-delete文件：</strong></p> <h2 id="别慌，未完待续～"><a href="#别慌，未完待续～" aria-hidden="true" class="header-anchor">#</a> 别慌，未完待续～</h2></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.1a5a821a.js" defer></script><script src="/blog/assets/js/2.97287b3e.js" defer></script><script src="/blog/assets/js/3.0a84591e.js" defer></script>
  </body>
</html>
