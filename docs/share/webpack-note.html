<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack随手记 | wecode 前端团队</title>
    <meta name="description" content="致力于利用科技的力量，让孩子们学习编程的过程更轻松、更有趣！">
    <link rel="icon" href="favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/blog/assets/css/0.styles.1274d17f.css" as="style"><link rel="preload" href="/blog/assets/js/app.08513d65.js" as="script"><link rel="preload" href="/blog/assets/js/2.446eaf65.js" as="script"><link rel="preload" href="/blog/assets/js/13.439a4d6a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.eec17b1f.js"><link rel="prefetch" href="/blog/assets/js/11.fa7252d5.js"><link rel="prefetch" href="/blog/assets/js/12.3fccf35e.js"><link rel="prefetch" href="/blog/assets/js/14.3bbeb86b.js"><link rel="prefetch" href="/blog/assets/js/15.96c8a2dd.js"><link rel="prefetch" href="/blog/assets/js/16.746b8878.js"><link rel="prefetch" href="/blog/assets/js/17.e0bf7593.js"><link rel="prefetch" href="/blog/assets/js/3.d41ecb86.js"><link rel="prefetch" href="/blog/assets/js/4.e2e0255b.js"><link rel="prefetch" href="/blog/assets/js/5.1ca98889.js"><link rel="prefetch" href="/blog/assets/js/6.85bac595.js"><link rel="prefetch" href="/blog/assets/js/7.b0e4b867.js"><link rel="prefetch" href="/blog/assets/js/8.1d1159c4.js"><link rel="prefetch" href="/blog/assets/js/9.03a2c2e4.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.1274d17f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">wecode 前端团队</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/share/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/blog/share/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-note.html" class="nav-link router-link-exact-active router-link-active">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">深入scratch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/en/webpack.html" class="nav-link">webpack 英文文档学习</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/wecode-fe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/share/env.html" class="nav-link">环境配置</a></li><li class="dropdown-item"><!----> <a href="/blog/share/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/blog/share/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/share/webpack-note.html" class="nav-link router-link-exact-active router-link-active">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/blog/scratch/links.html" class="nav-link">深入scratch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/en/webpack.html" class="nav-link">webpack 英文文档学习</a></li></ul></div></div><div class="nav-item"><a href="/blog/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/wecode-fe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack随手记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/share/webpack-note.html#简述下webpack的构建流程" class="sidebar-link">简述下Webpack的构建流程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/webpack-note.html#tree-shaking的理解" class="sidebar-link">Tree Shaking的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/webpack-note.html#scope-hoisting的理解" class="sidebar-link">Scope Hoisting的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/webpack-note.html#code-splitting的理解" class="sidebar-link">Code Splitting的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/webpack-note.html#file-loader和url-loader的区别" class="sidebar-link">file-loader和url-loader的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/webpack-note.html#聊聊热更新的实现" class="sidebar-link">聊聊热更新的实现</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/webpack-note.html#webpack-dev-server的理解" class="sidebar-link">webpack-dev-server的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/share/webpack-note.html#文件名hash值" class="sidebar-link">文件名hash值</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack随手记"><a href="#webpack随手记" aria-hidden="true" class="header-anchor">#</a> Webpack随手记</h1> <blockquote><p>本文记录了一些webpack的核心功能，包含名词解释以及使用场景等，欢迎大家补充...</p></blockquote> <h2 id="简述下webpack的构建流程"><a href="#简述下webpack的构建流程" aria-hidden="true" class="header-anchor">#</a> 简述下Webpack的构建流程</h2> <ol><li>初始化：启动构建，读取与合并配置参数，加载相应的Plugins，实例化Compiler；</li> <li>编译：从entry出发，针对每个module串行调用对应的loader去翻译文件内容，再找到该module依赖的module，递归地进行编译处理；</li> <li>输出：对编译后的module组合成chunk，再把chunk转换成文件，输出到output指定目录下；</li></ol> <h2 id="tree-shaking的理解"><a href="#tree-shaking的理解" aria-hidden="true" class="header-anchor">#</a> Tree Shaking的理解</h2> <blockquote><p>你可以将应用程序想象为一棵树。实际使用的源代码和库表示树的绿色活叶，死亡代码代表了被秋天消耗掉的棕色枯叶。为了除掉枯叶，你必须摇动这棵树，使它们落下，这就是所谓的“摇树优化”。</p></blockquote> <p>Webpack4里，配置参数mode为production(即生产环境)时，默认开启了Tree Shaking功能，若值为none则关闭了Tree Shaking。例如值引用了loadsh的isEqual方法，打包时只打引用过的模块。所以，我们为了利用<a href="https://webpack.js.org/guides/tree-shaking/#root" target="_blank" rel="noopener noreferrer">Tree Shaking<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的优势，建议如下：</p> <ul><li>使用ES2015模块语法（如import 和 export）；</li> <li>确保没有编译器将ES2015模块语法转换为CommonJS模块（这是流行的babel preset@babel/preset env的默认行为-有关详细信息，<a href="https://www.babeljs.cn/docs/babel-preset-env" target="_blank" rel="noopener noreferrer">请参阅文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）；</li> <li>将”sideEffects“(副作用)属性添加到项目的package.json文件中；</li> <li>使用生产模式配置选项启用各种优化，包括压缩和Tree Shaking；</li></ul> <h2 id="scope-hoisting的理解"><a href="#scope-hoisting的理解" aria-hidden="true" class="header-anchor">#</a> Scope Hoisting的理解</h2> <blockquote><p>原理：将所有模块的代码按照引用顺序放在一个函数作用域里 ，然后适当的重命名一些变量以防止变量名冲突。通过scope hoisting可减少函数声明代码合内存开销。</p></blockquote> <p>如果不开启scope hoisting，会导致大量作用域包裹代码，导致体积增大（模块越多越明显），运行代码时创建的函数作用域变多（大量的IIFE匿名闭包），内存开销大。</p> <ul><li>Webpack4环境，配置参数mode为production(即生产环境)时，默认开启了scope hoisting功能。</li> <li>Webpack3环境，需要在plugins里手动配置，<code>new webpack.optimize.ModuleConcatenationPlugin()</code>，会将es6里的import转换成__webpack__require__，export转换成__webpack_exports__。</li></ul> <h2 id="code-splitting的理解"><a href="#code-splitting的理解" aria-hidden="true" class="header-anchor">#</a> Code Splitting的理解</h2> <blockquote><p>代码拆分是Webpack最引人注目的特性之一。此功能允许您将代码拆分为各种捆绑包，然后可以按需或并行加载。它可以用来实现更小的捆绑包和控制资源负载优先级，如果正确使用，这会对加载时间产生重大影响。</p></blockquote> <p>有三种通用的代码拆分方法：</p> <ol><li>入口点：使用入口配置手动拆分代码。</li> <li>防止重复：使用SplitChunksPlugin来删除和拆分块。</li> <li>动态导入：通过模块内的内联函数调用拆分代码。</li></ol> <h2 id="file-loader和url-loader的区别"><a href="#file-loader和url-loader的区别" aria-hidden="true" class="header-anchor">#</a> file-loader和url-loader的区别</h2> <blockquote><p>url-loader内部使用了file-loader，都可以处理图片和字体，不过url-loader还可以将较小资源转化成base64字符串。</p></blockquote> <ul><li>file-loader：文件加载器将文件的import/require()解析为URL，并将文件发送到输出目录。</li> <li>url-loader：用于将文件转换为base64 URI的Webpack加载程序。</li></ul> <h2 id="聊聊热更新的实现"><a href="#聊聊热更新的实现" aria-hidden="true" class="header-anchor">#</a> 聊聊热更新的实现</h2> <blockquote><p>本话题主要想讲webpack-dev-server 与 hot-module-replacement-plugin之间的关系，需要从两者的功能上来分析说明。</p></blockquote> <p>单独写两个包也是出于功能的解耦来考虑的。简单来说就是：hot-module-replacement-plugin 包给 webpack-dev-server 提供了热更新的能力。</p> <ul><li>webpack-dev-server(WDS)的功能提供 bundle server的能力，就是生成的 bundle.js 文件可以通过 localhost://xxx 的方式去访问，另外 WDS 也提供 livereload(浏览器的自动刷新)。</li> <li>hot-module-replacement-plugin 的作用是提供 HMR 的 runtime，并且将 runtime 注入到 bundle.js 代码里面去。一旦磁盘里面的文件修改，那么 HMR server 会将有修改的 js module 信息发送给 HMR runtime，然后 HMR runtime 去局部更新页面的代码。因此这种方式可以不用刷新浏览器。</li></ul> <h2 id="webpack-dev-server的理解"><a href="#webpack-dev-server的理解" aria-hidden="true" class="header-anchor">#</a> webpack-dev-server的理解</h2> <blockquote><p>webpack-dev-server 是webpack-dev-middleware的封装版，细聊一下webpack-dev-middleware灵活的场景？</p></blockquote> <ul><li>webpack-dev-server实际上相当于启用了一个express的Http服务器+调用webpack-dev-middleware。它的作用主要是用来伺服资源文件。这个Http服务器和client使用了websocket通讯协议，原始文件作出改动后，webpack-dev-server会用webpack实时的编译，再用webpack-dev-middleware将webpack编译后文件会输出到内存中。适合纯前端项目，很难编写后端服务，进行整合。</li> <li>webpack-dev-middleware输出的文件存在于内存中。你定义了 webpack.config，webpack 就能据此梳理出entry和output模块的关系脉络，而 webpack-dev-middleware 就在此基础上形成一个文件映射系统，每当应用程序请求一个文件，它匹配到了就把内存中缓存的对应结果以文件的格式返回给你，反之则进入到下一个中间件。</li></ul> <h2 id="文件名hash值"><a href="#文件名hash值" aria-hidden="true" class="header-anchor">#</a> 文件名hash值</h2> <ul><li>hash，如果都使用hash的话，因为这是工程级别的，即每次修改任何一个文件，所有文件名的hash至都将改变。所以一旦修改了任何一个文件，整个项目的文件缓存都将失效。</li> <li>chunkhash，它可根据不同的入口文件(Entry)进行依赖文件解析、构建对应的chunk，生成对应的哈希值。在生产环境里把一些公共库和程序入口文件区分开，单独打包构建，接着我们采用chunkhash的方式生成哈希值，那么只要我们不改动公共库的代码，就可以保证其哈希值不会受影响，并且webpack4中支持了异步import功能。</li> <li>contenthash，它是针对文件内容级别的，只有你自己模块的内容变了，那么hash值才改变。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.08513d65.js" defer></script><script src="/blog/assets/js/2.446eaf65.js" defer></script><script src="/blog/assets/js/13.439a4d6a.js" defer></script>
  </body>
</html>
